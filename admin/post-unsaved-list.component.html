<template>
  <p>Unsaved changes:</p>
  <ul class="unsaved">
    <li {for-unsaved}><a href="/admin/edit?filepath={{encodedPath}}">{{name}}</a></li>
  </ul>
</template>

<script type="module">
  import { PostDraft } from './post-draft.js';

  // @ts-check
  export const config = {
    useShadowDOM: false,
    renderOnSetters: ['unsaved'],
  };

  export class View {
    /** @param {DocumentFragment} fragment */
    constructor(fragment) {
      /** @type {{path: string, encodedPath: string}[]} */
      this.unsaved = [];

      for (let i = 0; i < localStorage.length; i++) {
        const keyParts = localStorage.key(i).match(/^gh_post_(.*)/)
        const filepath = keyParts && keyParts[1];
        if (!filepath || filepath === 'new') {
          continue;
        }

        this.unsaved.push({
          name: filepath,
          encodedPath: window.encodeURIComponent(filepath),
        });
      }
    }
  }
</script>
