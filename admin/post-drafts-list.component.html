<template>
  <p>Drafts:</p>
  <ul class="drafts">
    <li><a href="/admin/edit"><i class="icon fas fa-plus"></i>New</a></li>
    <li><i class="icon fas fa-spinner fa-pulse"></i></li>
    <li {for-draft}><a href="/admin/edit?filepath={{ encodedPath }}">{{ name }}</a></li>
  </ul>
</template>

<script type="module">
  import { PostDraft } from './post-draft.js';

  // @ts-check
  export const config = {
    useShadowDOM: false,
  };

  export class View {
    /** @param {DocumentFragment} fragment */
    constructor(fragment) {
      const liForDraft = Array.from(fragment.querySelectorAll('li')).find(li => li.hasAttribute('{for-draft}'));
      const spinner = fragment.querySelector('.fa-spinner').parentElement;
      const ul = fragment.querySelector('ul');

      liForDraft.remove();

      PostDraft.list().then(drafts => {
        spinner.remove();

        drafts.forEach(d => {
          const li = liForDraft.cloneNode(true);
          li.innerHTML = li.innerHTML.replace(
            /\{\{([^}]+)\}\}/g,
            (whole, expr) => {
              expr = expr.trim();
              return d[expr] || '';
            },
          );
          ul.appendChild(li);
        });
      });
    }
  }
</script>
